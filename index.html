<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Opmeting</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    background: #f5f5f5;
    font-size: 16px;
  }

  h1 {
    font-size: 1.4rem;
    text-align: center;
  }

  .top-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }

  button {
    flex: 1;
    font-size: 1rem;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: #007bff;
    color: white;
  }

  .new {
    background: #6c757d;
  }

  select, input {
    font-size: 1rem;
    padding: 8px;
    width: 100%;
    margin-top: 6px;
  }

  .warning {
    background: #ff5252;
    color: white;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
    font-size: 0.95rem;
    margin-bottom: 10px;
  }

  .element {
    background: white;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    position: relative;
  }

  .delete {
    position: absolute;
    top: 8px;
    right: 8px;
    background: none;
    border: none;
    font-size: 1.3rem;
    color: #777;
  }

  .photos {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 8px;
  }

  .photo-box {
    position: relative;
  }

  .photo-box img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 8px;
  }

  .photo-box span {
    position: absolute;
    top: -6px;
    right: -6px;
    background: red;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 14px;
    text-align: center;
    line-height: 20px;
  }

  .camera {
    font-size: 1.6rem;
    background: #eee;
    border-radius: 8px;
    padding: 8px;
    display: inline-block;
    margin-top: 8px;
  }
</style>
</head>

<body>

<h1>Opmeting</h1>

<div id="warning" class="warning" style="display:none;">
‚ö†Ô∏è Bij vernieuwen (refresh) kan alles verloren gaan
</div>

<div class="top-buttons">
  <button onclick="addElement()">‚ûï Element</button>
  <button class="new" onclick="newProject()">üÜï Nieuw project</button>
</div>

<div id="elements"></div>

<script>
let elements = JSON.parse(localStorage.getItem("elements") || "[]");

function save() {
  localStorage.setItem("elements", JSON.stringify(elements));
  document.getElementById("warning").style.display = "block";
}

window.onbeforeunload = () => true;

function newProject() {
  if(confirm("Nieuw project starten?\nAlle huidige gegevens worden gewist.")) {
    elements = [];
    localStorage.removeItem("elements");
    document.getElementById("warning").style.display = "none";
    render();
  }
}

function addElement() {
  elements.push({ type:"raam", w:"", h:"", photos:[] });
  save();
  render();
}

function removeElement(i) {
  if(confirm("Element verwijderen?")) {
    elements.splice(i,1);
    save();
    render();
  }
}

function addPhoto(i, file) {
  const reader = new FileReader();
  reader.onload = e => {
    elements[i].photos.push(e.target.result);
    save();
    render();
  };
  reader.readAsDataURL(file);
}

function removePhoto(i,p) {
  elements[i].photos.splice(p,1);
  save();
  render();
}

function render() {
  const c = document.getElementById("elements");
  c.innerHTML = "";

  elements.forEach((el,i)=>{
    c.innerHTML += `
      <div class="element">
        <button class="delete" onclick="removeElement(${i})">üóëÔ∏è</button>

        <select onchange="elements[${i}].type=this.value;save();">
          <option ${el.type=="raam"?"selected":""}>raam</option>
          <option ${el.type=="deur"?"selected":""}>deur</option>
          <option ${el.type=="poort"?"selected":""}>poort</option>
        </select>

        <input placeholder="Breedte (cm)" value="${el.w}"
          oninput="elements[${i}].w=this.value;save();">

        <input placeholder="Hoogte (cm)" value="${el.h}"
          oninput="elements[${i}].h=this.value;save();">

        <label class="camera">
          üì∑
          <input type="file" accept="image/*" capture="environment"
            hidden onchange="addPhoto(${i},this.files[0])">
        </label>

        <div class="photos">
          ${el.photos.map((p,j)=>`
            <div class="photo-box">
              <img src="${p}">
              <span onclick="removePhoto(${i},${j})">√ó</span>
            </div>
          `).join("")}
        </div>
      </div>
    `;
  });
}

render();
</script>

</body>
</html>
